import{g as fe,a as be,s as re,B as $e,_ as j,r as ve,b as r,c as ye,u as Ae,d as ze,j as e,e as ke,f as N,h as we,i as ce,k as Fe,l as Le,m as Oe,n as Re,o as Ee,p as de,L as Ne,C as Me,F as Y,P as We,G as X,q as u,S as me,T as b,t as ee,I as te,O as oe,v as q,E as ue,w as ne,x as Ue,y as Ve,V as He,z as Ze,A as se,D as ae,H as _e,J as qe,K as Ge,M as he,N as ge,Q as Je,R as g}from"./index-b14a4f2c.js";import{S as Qe,a as pe,b as xe,A as Ke}from"./ArrowBack-8624e6a4.js";function Ye(t){return fe("PrivateSwitchBase",t)}be("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const Xe=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],et=t=>{const{classes:a,checked:l,disabled:y,edge:p}=t,x={root:["root",l&&"checked",y&&"disabled",p&&`edge${N(p)}`],input:["input"]};return we(x,Ye,a)},tt=re($e)(({ownerState:t})=>j({padding:9,borderRadius:"50%"},t.edge==="start"&&{marginLeft:t.size==="small"?-3:-12},t.edge==="end"&&{marginRight:t.size==="small"?-3:-12})),ot=re("input",{shouldForwardProp:ve})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),nt=r.forwardRef(function(a,l){const{autoFocus:y,checked:p,checkedIcon:x,className:I,defaultChecked:B,disabled:$,disableFocusRipple:n=!1,edge:k=!1,icon:O,id:C,inputProps:c,inputRef:A,name:S,onBlur:T,onChange:w,onFocus:z,readOnly:d,required:M=!1,tabIndex:W,type:L,value:F}=a,U=ye(a,Xe),[R,V]=Ae({controlled:p,default:!!B,name:"SwitchBase",state:"checked"}),f=ze(),H=v=>{z&&z(v),f&&f.onFocus&&f.onFocus(v)},G=v=>{T&&T(v),f&&f.onBlur&&f.onBlur(v)},Z=v=>{if(v.nativeEvent.defaultPrevented)return;const _=v.target.checked;V(_),w&&w(v,_)};let P=$;f&&typeof P>"u"&&(P=f.disabled);const J=L==="checkbox"||L==="radio",D=j({},a,{checked:R,disabled:P,disableFocusRipple:n,edge:k}),E=et(D);return e.jsxs(tt,j({component:"span",className:ke(E.root,I),centerRipple:!0,focusRipple:!n,disabled:P,tabIndex:null,role:void 0,onFocus:H,onBlur:G,ownerState:D,ref:l},U,{children:[e.jsx(ot,j({autoFocus:y,checked:p,defaultChecked:B,className:E.input,disabled:P,id:J?C:void 0,name:S,onChange:Z,readOnly:d,ref:A,required:M,ownerState:D,tabIndex:W,type:L},L==="checkbox"&&F===void 0?{}:{value:F},c)),R?x:O]}))}),st=nt,at=ce(e.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),it=ce(e.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),rt=ce(e.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ct(t){return fe("MuiCheckbox",t)}const lt=be("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ie=lt,dt=["checkedIcon","color","icon","indeterminate","indeterminateIcon","inputProps","size","className"],mt=t=>{const{classes:a,indeterminate:l,color:y,size:p}=t,x={root:["root",l&&"indeterminate",`color${N(y)}`,`size${N(p)}`]},I=we(x,ct,a);return j({},a,I)},ut=re(st,{shouldForwardProp:t=>ve(t)||t==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(t,a)=>{const{ownerState:l}=t;return[a.root,l.indeterminate&&a.indeterminate,a[`size${N(l.size)}`],l.color!=="default"&&a[`color${N(l.color)}`]]}})(({theme:t,ownerState:a})=>j({color:(t.vars||t).palette.text.secondary},!a.disableRipple&&{"&:hover":{backgroundColor:t.vars?`rgba(${a.color==="default"?t.vars.palette.action.activeChannel:t.vars.palette[a.color].mainChannel} / ${t.vars.palette.action.hoverOpacity})`:Fe(a.color==="default"?t.palette.action.active:t.palette[a.color].main,t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},a.color!=="default"&&{[`&.${ie.checked}, &.${ie.indeterminate}`]:{color:(t.vars||t).palette[a.color].main},[`&.${ie.disabled}`]:{color:(t.vars||t).palette.action.disabled}})),ht=e.jsx(it,{}),gt=e.jsx(at,{}),pt=e.jsx(rt,{}),xt=r.forwardRef(function(a,l){var y,p;const x=Le({props:a,name:"MuiCheckbox"}),{checkedIcon:I=ht,color:B="primary",icon:$=gt,indeterminate:n=!1,indeterminateIcon:k=pt,inputProps:O,size:C="medium",className:c}=x,A=ye(x,dt),S=n?k:$,T=n?k:I,w=j({},x,{color:B,indeterminate:n,size:C}),z=mt(w);return e.jsx(ut,j({type:"checkbox",inputProps:j({"data-indeterminate":n},O),icon:r.cloneElement(S,{fontSize:(y=S.props.fontSize)!=null?y:C}),checkedIcon:r.cloneElement(T,{fontSize:(p=T.props.fontSize)!=null?p:C}),ownerState:w,ref:l,className:ke(z.root,c)},A,{classes:z}))}),ft=xt,bt={"akriti786shukla@gmail.com":!1,"mail@manojgowda.in":!1,"manojgowdabr89@gmail.com":!1};function kt(){const{login:t,setisAdmin:a,setisLogin:l,skipotp:y,verifyOtp:p,sendOtpByEmail:x}=Oe(),I=Re(),B=Ee(),$=de(B.breakpoints.down("md"));de(B.breakpoints.down("sm"));const[n,k]=r.useState({email:"",password:"",otp:"",devicedetails:"Not Available",loginTime:"",clientInfo:{}}),[O,C]=r.useState(""),[c,A]=r.useState({}),[S,T]=r.useState(!1),[w,z]=r.useState(!1),[d,M]=r.useState("login"),[W,L]=r.useState(0),[F,U]=r.useState(0),[R,V]=r.useState(!1),[f,H]=r.useState(!1),[G,Z]=r.useState(!1),[P,J]=r.useState(!0);r.useEffect(()=>{let o;return F>0?o=setInterval(()=>{U(F-1)},1e3):V(!1),()=>clearInterval(o)},[F]);const D=()=>new Date().toISOString().replace("T"," ").substr(0,19),E=()=>{const o=Intl.DateTimeFormat().resolvedOptions().timeZone,s=new Date().getTimezoneOffset(),i=Math.abs(Math.floor(s/60)),m=Math.abs(s%60),K=s>0?"-":"+";return`${o} (UTC${K}${i.toString().padStart(2,"0")}:${m.toString().padStart(2,"0")})`},v=()=>{var o;return{screenWidth:window.screen.width,screenHeight:window.screen.height,colorDepth:window.screen.colorDepth,pixelRatio:window.devicePixelRatio,screenOrientation:((o=screen.orientation)==null?void 0:o.type)||"N/A"}},_=async()=>{let o=navigator.connection||navigator.mozConnection||navigator.webkitConnection;return o?{effectiveType:o.effectiveType,downlink:o.downlink,rtt:o.rtt,saveData:o.saveData}:"Network info not available"},je=()=>({userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,languages:navigator.languages,cookiesEnabled:navigator.cookieEnabled,doNotTrack:navigator.doNotTrack,vendor:navigator.vendor,maxTouchPoints:navigator.maxTouchPoints,hardwareConcurrency:navigator.hardwareConcurrency,deviceMemory:navigator.deviceMemory||"N/A"});r.useEffect(()=>{(async()=>{try{const s=await navigator.getBattery(),i={level:(s.level*100).toFixed(0),charging:s.charging,chargingTime:s.chargingTime,dischargingTime:s.dischargingTime},m=await _(),K=v(),Pe=je(),h={loginDateTime:D(),timeZone:E(),battery:i,network:m,screen:K,browser:Pe,platform:{os:navigator.platform,vendor:navigator.vendor,userAgent:navigator.userAgent}},De=`Login Time (UTC): ${h.loginDateTime}
          TimeZone: ${h.timeZone}
          Device: ${h.platform.os}
          Browser: ${h.browser.vendor}
          Screen: ${h.screen.screenWidth}x${h.screen.screenHeight}
          Battery: ${h.battery.level}% (${h.battery.charging?"Charging":"Not Charging"})
          Network: ${typeof h.network=="object"?h.network.effectiveType:"N/A"}
          Language: ${h.browser.language}`.trim();k(Be=>({...Be,devicedetails:De,loginTime:h.loginDateTime,clientInfo:h})),Z(!0)}catch{const i={loginDateTime:D(),timeZone:E(),platform:navigator.platform,userAgent:navigator.userAgent};k(m=>({...m,devicedetails:`Login Time: ${i.loginDateTime}, Device: ${i.platform}`,loginTime:i.loginDateTime,clientInfo:i})),Z(!0),g.error("Error fetching complete device details")}})()},[]);const Q=o=>{const{name:s,value:i}=o.target;k({...n,[s]:i}),c[s]&&A({...c,[s]:null})},Ie=()=>{const o={};return n.email?/^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,6}$/.test(n.email)||(o.email="Please enter a valid email address"):o.email="Email is required",d==="login"&&!n.password?o.password="Password is required":d==="login"&&n.password.length<6&&(o.password="Password must be at least 6 characters"),d==="otp"&&!n.otp&&(o.otp="OTP is required"),A(o),Object.keys(o).length===0},le=async()=>{try{const o=btoa(`${n.email}:${n.password}`);return await(await fetch("https://vmarg.skoegle.co.in/api/auth/user/check",{method:"GET",headers:{Authorization:`Basic ${o}`}})).json()}catch(o){return console.error("Error checking user:",o),{valid:!1,message:"Error checking user credentials"}}},Ce=async o=>{if(o.preventDefault(),Ie()){T(!0);try{if(y||bt[n.email]){const s={...n,loginTimestamp:D()},i=await t(s);i!=null&&i.valid?(l(i.valid),a(i.isAdmin),localStorage.setItem("isAdmin",i.isAdmin),localStorage.setItem("isLogin",i.valid),localStorage.setItem("token",i.token),localStorage.setItem("custommerid",i.custommerId),localStorage.setItem("lastLoginTime",s.loginTimestamp),localStorage.setItem("clientInfo",JSON.stringify(n.clientInfo)),sessionStorage.setItem("termsAccepted",!0),g.success("Welcome back!"),setTimeout(()=>{window.location.reload(),I("/")},2e3)):g.error("User may not exist or the password is incorrect. Please check your credentials or create an account.")}else if(d==="login"){const s=await le();s.valid?(await x(n.email,C),g.success("OTP sent to your email"),M("otp")):g.error(s.message||"User may not exist or the password is incorrect. Please check your credentials.")}else if(d==="otp"){const s=p(n.otp,n.email,O);if(s!=null&&s.valid){const i={...n,loginTimestamp:D()},m=await t(i);m!=null&&m.valid?(l(m.valid),a(m.isAdmin),localStorage.setItem("isAdmin",m.isAdmin),localStorage.setItem("isLogin",m.valid),localStorage.setItem("token",m.token),localStorage.setItem("custommerid",m.custommerId),localStorage.setItem("lastLoginTime",i.loginTimestamp),localStorage.setItem("clientInfo",JSON.stringify(n.clientInfo)),sessionStorage.setItem("termsAccepted",!0),g.success("Welcome back!"),setTimeout(()=>{window.location.reload(),I("/")},2e3)):(g.error("User may not exist or the password is incorrect. Please check your credentials or create an account."),setTimeout(()=>{window.location.reload()},3e3))}else g.error(s.message||"Invalid OTP. Please try again.")}}catch(s){g.error("An error occurred. Please try again."),console.error("Login error:",s)}finally{T(!1)}}},Se=async()=>{if(W<5)try{H(!0),(await le()).valid?(await x(n.email,C),g.success("OTP resent to your email"),L(W+1),V(!0),U(60)):g.error("Failed to verify credentials. Please go back and try again.")}catch{g.error("Failed to resend OTP. Please try again.")}finally{H(!1)}else g.error("You have reached the maximum resend attempts. Please try again later.")},Te=()=>{M("login"),k({...n,otp:""}),A({...c,otp:null})};return e.jsx(Ne,{title:"Vmarg - Login",children:e.jsx(Me,{maxWidth:"md",sx:{py:{xs:2,md:8}},children:e.jsx(Y,{in:G,timeout:600,children:e.jsx(We,{elevation:5,sx:{borderRadius:2,overflow:"hidden",bgcolor:"background.paper"},children:e.jsxs(X,{container:!0,children:[!$&&e.jsxs(X,{item:!0,md:5,sx:{background:"linear-gradient(to bottom, #00796b, #004d40)",p:4,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",color:"white"},children:[e.jsxs(u,{sx:{mb:4},children:[e.jsx(me,{sx:{fontSize:60,mb:2,opacity:.8}}),e.jsx(b,{variant:"h4",fontWeight:"bold",sx:{mb:2},children:"Welcome Back"}),e.jsx(b,{variant:"body1",sx:{opacity:.9,mb:2},children:"Log in to access your V-Marg account and track your devices securely."}),e.jsxs(u,{sx:{mt:4},children:[e.jsx(b,{variant:"subtitle2",sx:{opacity:.8,fontSize:"0.85rem"},children:"Secure login with two-factor authentication"}),e.jsx(b,{variant:"subtitle2",sx:{opacity:.8,fontSize:"0.85rem"},children:"End-to-end encrypted connection"})]})]}),e.jsx(u,{sx:{position:"absolute",bottom:20,opacity:.7},children:e.jsxs(b,{variant:"caption",children:["Â© ",new Date().getFullYear()," V-Marg by Skoegle"]})})]}),e.jsxs(X,{item:!0,xs:12,md:7,sx:{p:{xs:2,sm:4},display:"flex",flexDirection:"column"},children:[e.jsxs(u,{sx:{mb:4,textAlign:$?"center":"left"},children:[$&&e.jsx(u,{sx:{display:"flex",justifyContent:"center",mb:2},children:e.jsx(me,{color:"primary",sx:{fontSize:40}})}),e.jsx(b,{variant:"h4",fontWeight:"bold",color:"primary",sx:{mb:1},children:d==="login"?"Sign In":"Verify OTP"}),e.jsx(b,{variant:"body2",color:"text.secondary",children:d==="login"?"Enter your credentials to access your account":`We've sent a verification code to ${n.email}`})]}),e.jsxs(Qe,{activeStep:d==="login"?0:1,alternativeLabel:!0,sx:{mb:4},children:[e.jsx(pe,{children:e.jsx(xe,{children:"Credentials"})}),e.jsx(pe,{children:e.jsx(xe,{children:"Verification"})})]}),e.jsxs(u,{component:"form",onSubmit:Ce,sx:{width:"100%"},children:[d==="login"?e.jsx(Y,{in:d==="login",timeout:500,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(ee,{variant:"outlined",fullWidth:!0,error:!!c.email,children:[e.jsx(te,{htmlFor:"email",children:"Email Address"}),e.jsx(oe,{id:"email",type:"email",name:"email",value:n.email,onChange:Q,startAdornment:e.jsx(q,{position:"start",children:e.jsx(ue,{color:"action"})}),label:"Email Address"}),c.email&&e.jsx(ne,{children:c.email})]}),e.jsxs(ee,{variant:"outlined",fullWidth:!0,error:!!c.password,children:[e.jsx(te,{htmlFor:"password",children:"Password"}),e.jsx(oe,{id:"password",type:w?"text":"password",name:"password",value:n.password,onChange:Q,startAdornment:e.jsx(q,{position:"start",children:e.jsx(Ue,{color:"action"})}),endAdornment:e.jsx(q,{position:"end",children:e.jsx(Ve,{"aria-label":"toggle password visibility",onClick:()=>z(!w),edge:"end",children:w?e.jsx(He,{}):e.jsx(Ze,{})})}),label:"Password"}),c.password&&e.jsx(ne,{children:c.password})]}),e.jsx(u,{sx:{display:"flex",justifyContent:"flex-end"},children:e.jsx(b,{variant:"body2",component:se,to:"/forgotpassword",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Forgot Password?"})})]})}):e.jsx(Y,{in:d==="otp",timeout:500,children:e.jsxs(u,{sx:{display:"flex",flexDirection:"column",gap:3},children:[e.jsxs(u,{sx:{mb:1},children:[e.jsx(ae,{startIcon:e.jsx(Ke,{}),onClick:Te,sx:{color:"text.secondary",mb:2},children:"Back to Login"}),e.jsx(_e,{variant:"outlined",sx:{mb:2,bgcolor:"primary.50"},children:e.jsxs(qe,{children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",mb:1},children:[e.jsx(ue,{color:"primary",sx:{mr:1}}),e.jsx(b,{variant:"body2",fontWeight:"medium",children:n.email})]}),e.jsx(b,{variant:"caption",color:"text.secondary",children:"Please check your email inbox for the OTP and enter it below"})]})})]}),e.jsxs(ee,{variant:"outlined",fullWidth:!0,error:!!c.otp,children:[e.jsx(te,{htmlFor:"otp",children:"Enter OTP"}),e.jsx(oe,{id:"otp",name:"otp",value:n.otp,onChange:Q,startAdornment:e.jsx(q,{position:"start",children:e.jsx(Ge,{color:"action"})}),label:"Enter OTP"}),c.otp&&e.jsx(ne,{children:c.otp})]}),e.jsx(ae,{variant:"outlined",color:"secondary",disabled:R||f,onClick:Se,startIcon:f&&e.jsx(he,{size:16,color:"inherit"}),children:f?"Resending...":R?`Resend OTP (${F}s)`:"Resend OTP"})]})}),e.jsxs(e.Fragment,{children:[!sessionStorage.getItem("termsAccepted")&&e.jsxs(u,{sx:{display:"flex",alignItems:"center",justifyContent:"flex-start"},children:[e.jsx(ft,{checked:P,onChange:o=>J(o.target.checked)}),e.jsxs(b,{children:["By creating an account, you agree to the"," ",e.jsx(ge,{variant:"body2",component:se,to:"https://skoegle.in/Terms%20and%20Conditions.html",target:"_blank",sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Terms and Conditions"})]})]}),e.jsx(u,{children:e.jsx(ae,{variant:"contained",color:"primary",fullWidth:!0,type:"submit",disabled:!P||S,startIcon:S?e.jsx(he,{size:20,color:"inherit"}):e.jsx(Je,{}),sx:{mt:3,py:1.2,borderRadius:30,backgroundColor:"#00796b",fontWeight:"bold","&:hover":{backgroundColor:"#00635a"},boxShadow:2},children:S?"Please wait...":"Continue"})})]}),d==="login"&&e.jsx(u,{sx:{mt:3,textAlign:"center"},children:e.jsxs(b,{variant:"body2",children:["Don't have an account?"," ",e.jsx(ge,{component:se,to:"/signup",sx:{fontWeight:"bold",color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"}},children:"Sign Up"})]})})]})]})]})})})})})}export{kt as default};
